<venda_block pageref=spring_cat_test>
<script type="text/javascript" src="<venda_entmediaadd>/ebiz/<venda_bsref>/resources/js/external/jquery.lazyload.min.js"></script>
<script type="text/javascript" src="http://demos.flesler.com/jquery/scrollTo/js/jquery.scrollTo-min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function () {
    superScrolling.init();
});
var offset = jQuery(".gameContents").offset(),
	offsetBottom = jQuery(document).outerHeight() - (offset.top + jQuery(".gameContents").outerHeight()),
	superScrolling = {
      options: {
        $headerHeight: offset.top,
        $footerHeight: jQuery(document).outerHeight() - (offset.top + jQuery(".gameContents").outerHeight()),
        $controlHeight: jQuery(".controlBox").outerHeight(),
        $docHeight: jQuery(document).outerHeight(),
        $currentPage: "." + jQuery(".gameContents").attr("id"),
        topPad: offset.top
      },
      init: function () {
        this.stickyScroller();
      },
      stickyScroller: function () {
        jQuery(".controlBox, .gameSticky").css('top',superScrolling.options.topPad);
        jQuery(superScrolling.options.$currentPage).prevAll().addClass("fullyLoaded");
        jQuery(window).bind( "scroll", function(e) {
          /*var $fromTop = jQuery(window).scrollTop();
          if($fromTop > superScrolling.options.$headerHeight + superScrolling.options.topPad) {
            jQuery(".controlBox").css("top",  superScrolling.options.topPad + "px");
            jQuery(".controlBox").addClass("fixMe");
          }
          if($fromTop < superScrolling.options.$headerHeight) {
            jQuery(".controlBox").css("top",  superScrolling.options.topPad + "px");
            jQuery(".controlBox").removeClass("fixMe");
          }
          if($fromTop > superScrolling.options.$docHeight - superScrolling.options.$footerHeight - superScrolling.options.$controlHeight - superScrolling.options.topPad) {
            jQuery(".controlBox").removeClass("fixMe");
            jQuery(".controlBox").css("top",  superScrolling.options.$docHeight - superScrolling.options.$footerHeight - superScrolling.options.$headerHeight - superScrolling.options.$controlHeight - superScrolling.options.topPad + "px");
          }*/
          superScrolling.loadMeUp();
        });
      },
      loadMeUp: function () {
          var $sticklerPlace = jQuery(".controlBox").offset(),
          	  $myWindow = jQuery(window).outerHeight(),
              empty = superScrolling.options.$headerHeight,
              fullUp = superScrolling.options.$docHeight - ($myWindow - offset.top),
              progress = Math.round(($sticklerPlace.top - empty) / (fullUp - empty) * 100)
              console.log(empty,fullUp,$sticklerPlace);
          jQuery(".controlBox " + superScrolling.options.$currentPage + " .loadProgress").css("height", progress + "%");
      }   
    }
jQuery(function() {          
    jQuery("img.lazy").lazyload({
        event : "lookbook"
    });
});
jQuery(window).bind("load", function() { 
    var timeout = setTimeout(function() { 
    	jQuery("img.lazy").trigger("lookbook");
    	jQuery(window).scroll(function() {
    		var gameStage = jQuery(".gameStage").text(),
    			scrollAmount = jQuery(window).scrollTop() - offset.top,
    			documentHeight = (jQuery(document).outerHeight() - offsetBottom - offset.top) - jQuery(window).outerHeight(),
    			scrollPercent = ((scrollAmount / documentHeight) * 100) / 3;
    		if (gameStage === "1") {
	    		if (scrollPercent.toFixed(0) <= 0) {
	    			jQuery(".percentage").text("0%");
	    		}
	    		else if (scrollPercent.toFixed(0) > 33) {
	    			jQuery(".percentage").text("33%");
	    		}
	    		else {
	    			jQuery(".percentage").text(scrollPercent.toFixed(0) + "%");
	    		}
    		}
    		if (gameStage === "2") {
    			scrollPercent = scrollPercent + 33;
	    		if (scrollPercent.toFixed(0) <= 33) {
	    			jQuery(".percentage").text("33%");
	    		}
	    		else if (scrollPercent.toFixed(0) > 66) {
	    			jQuery(".percentage").text("66%");
	    		}
	    		else {
	    			jQuery(".percentage").text(scrollPercent.toFixed(0) + "%");
	    		}
    		}
    		if (gameStage === "3") {
    			scrollPercent = scrollPercent + 66;
	    		if (scrollPercent.toFixed(0) <= 66) {
	    			jQuery(".percentage").text("66%");
	    		}
	    		else if (scrollPercent.toFixed(0) > 99) {
	    			jQuery(".percentage").text("100%");
	    		}
	    		else {
	    			jQuery(".percentage").text(scrollPercent.toFixed(0) + "%");
	    		}
    		}
    	});
    }, 0);
});
function scrollToAnchor(aid) {
    if (aid !== undefined) {
        jQuery(window).scrollTo(aid, 800, {
            margin: true
        });
    }
}
function scrollPreAnchor(adi) {
    if (adi !== undefined) {
        jQuery(window).scrollTo(adi, 800, {
            margin: true,
            offset: {top:+5}
        });
    }
}
jQuery(function() {
    var segments = jQuery('.segment'),
    	position = 0,
    	next = jQuery('.anchorLink-next'),
    	prev = jQuery('.anchorLink-prev').hide();
    next.click(function(evt) {
        scrollToAnchor(segments[position]);
    });
    prev.click(function(evt) {
	    scrollPreAnchor(segments[position - 2]);
    });
    jQuery(".toTop").click(function(evt) {
		scrollPreAnchor(segments[0]);
	});
    var lastScrollTop = 0;
    jQuery(window).scroll(function(event){
	    var st = jQuery(this).scrollTop(),
	    	scrollOffset = jQuery(".gameContents").offset(),
    		scrolled = jQuery(window).scrollTop() - scrollOffset.top,
    		segmentOffset = jQuery(segments[position]).offset(),
    		segmentTop = segmentOffset.top - scrollOffset.top,
    		segmentHeight = jQuery(".gameContents").outerHeight() / 4;
	    if (st > lastScrollTop){
		    if (scrolled >= segmentTop) {
			    segments[position += 1];
			}
       	}
       	else {
       		if (position !== 0) {
	       		if (scrolled <= (segmentTop - segmentHeight)) {
			    	segments[position -= 1];
			    }
       		}
	    }
	    if (position <= 1) {
		    prev.hide();
	    }
	    if (position > 1) {
		    prev.show();
	    }
	    lastScrollTop = st;
	});
});
var win = null;
function NewWindow(mypage,myname,w,h,scroll){
	LeftPosition = (screen.width) ? (screen.width-w)/2 : 0;
	TopPosition = (screen.height) ? (screen.height-h)/2 : 0;
	settings = 'height='+h+',width='+w+',top='+TopPosition+',left='+LeftPosition+',scrollbars='+scroll+',resizable'
	win = window.open(mypage,myname,settings)
}
</script>
</venda_block>